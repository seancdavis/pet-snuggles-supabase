---
import Greeting from "../../components/Greeting.astro";
import Layout from "../../components/Layout.astro";
import { supabase } from "../../utils/database";

export const prerender = false;

const { id } = Astro.params;

if (!id) {
  throw new Error("No pet id provided");
}

const { data: pet, error } = await supabase
  .from("pets")
  .select("*")
  .eq("id", id)
  .single();

if (error || !pet) {
  console.error(error);
  throw new Error("No pet found");
}
---

<Layout title={`${pet.name} | Pets`}>
  <section class="page-header">
    <Greeting greeting={pet.greeting} />
    <h1>{pet.name}</h1>
    <div class="bio">{pet.bio}</div>
  </section>

  <section>
    <form action={`/api/pets/${pet.id}/snuggle`} method="post">
      <h3>Snuggle {pet.name}!</h3>

      <div>
        {pet.name} has {pet.snuggles} snuggle{pet.snuggles === 1 ? "" : "s"}!
        You should give them some more!
      </div>

      <button type="submit">Give {pet.name} a snuggle</button>
    </form>
  </section>

  <section>
    <img
      src={`/.netlify/images?url=/images/${pet.image}&w=1500&h=1000&fit=cover`}
      alt={pet.name}
    />
  </section>
</Layout>

<style>
  .page-header {
    text-align: center;
  }

  .page-header h1 {
    margin: 0 0 2rem;
    padding: 0;
  }

  .bio {
    font-size: 1.5rem;
  }

  h3 {
    margin-bottom: 1rem;
    padding: 0;
    font-size: 1.5rem;
  }

  img {
    border-radius: 0.5rem;
    display: block;
    width: 100%;
  }
</style>
